{% comment %}
  Newsletter Popover Snippet
  Usage: {% render 'newsletter-popover', id: 'unique-id', title: 'Join Our Newsletter', text: 'Sign up for exclusive offers' %}

  Parameters:
  - id: Unique identifier for the popover (required)
  - title: Heading text for the popover (optional, defaults to 'Join Our Newsletter')
  - text: Description text (optional)
  - button_text: Submit button text (optional, defaults to 'Sign Up')
{% endcomment %}

{% assign popover_id = id | default: 'newsletter-popover' %}
{% assign newsletter_form_id = 'newsletter-popover-form-' | append: popover_id %}

<div id="{{ popover_id }}" class="modal modal--square modal--newsletter-popover" data-popover-id="{{ popover_id }}">
  <div class="modal__inner">
    <div class="modal__centered">
      <div class="modal__centered-content newsletter-popover">
        <div class="newsletter-popover__content">
          <h3 class="newsletter-popover__title">JOIN THE MEMBERSHIP</h3>

          <div class="newsletter-popover__text">
            Be the first to know about exclusive offers, new products, and community events. Join our membership today!
          </div>

          <div class="newsletter-popover__form-wrapper" id="form-wrapper-{{ popover_id }}">
            {% form 'customer', id: newsletter_form_id, class: 'newsletter-popover__form' %}
              <input type="hidden" name="contact[tags]" value="prospect,newsletter">
              <input type="hidden" name="contact[context]" value="popover">

              <div class="newsletter-popover__input-group">
                <label for="email-{{ popover_id }}" class="visually-hidden">
                  {{- 'general.newsletter_form.newsletter_email' | t -}}
                </label>
                <input
                  type="email"
                  name="contact[email]"
                  id="email-{{ popover_id }}"
                  class="newsletter-popover__input"
                  placeholder="{{ 'general.newsletter_form.newsletter_email' | t }}"
                  value="{{ form.email }}"
                  {% if form.errors %}
                    autofocus
                    aria-invalid="true"
                    aria-describedby="ContactFooter-error"
                  {% elsif form.posted_successfully? %}
                    aria-describedby="ContactFooter-success"
                  {% endif %}
                  autocorrect="off"
                  autocapitalize="off"
                  required
                >
                <button type="submit" class="newsletter-popover__submit btn">SIGN UP</button>

                {%- if form.errors -%}
                  <small class="newsletter-form__message form__message" id="ContactFooter-error">
                    <span class="svg-wrapper">
                      {{- 'icon-error.svg' | inline_asset_content -}}
                    </span>
                    {{- form.errors.translated_fields.email | capitalize }}
                    {{ form.errors.messages.email -}}
                  </small>
                {%- endif -%}
              </div>

              {%- if form.posted_successfully? -%}
                <h3
                  class="newsletter-form__message newsletter-form__message--success form__message"
                  id="ContactFooter-success"
                  tabindex="-1"
                  autofocus
                >
                  <span class="svg-wrapper">
                    {{- 'icon-success.svg' | inline_asset_content -}}
                  </span>
                  You're locked in to the community!
                </h3>
              {%- endif -%}
            {% endform %}
          </div>
        </div>

        <button
          type="button"
          class="modal__close js-modal-close newsletter-popover__close"
          aria-label="{{ 'general.accessibility.close_modal' | t }}"
        >
          <svg aria-hidden="true" focusable="false" role="presentation" class="icon icon-close" viewBox="0 0 64 64">
            <title>icon-X</title>
            <path d="m19 17.61 27.12 27.13m0-27.12L19 44.74"/>
          </svg>
        </button>
      </div>
    </div>
  </div>
</div>

<style>
  .modal--newsletter-popover .modal__inner {
    font-family: 'Barlow', sans-serif;
    /* background-color: blue; */
    background-color: red;
    box-shadow: 0 20px 60px rgba(0, 0, 0, 0.15);
    color: var(--colorTextBody, #000);
    max-width: 500px;
    width: 100%;
    border-radius: 2px;
    overflow: hidden;
  }

  .newsletter-popover {
    padding: 3rem 2rem;
    position: relative;
  }

  .newsletter-popover__title {
    font-size: 2rem;
    margin: 0 0 1rem;
    text-align: center;
    font-weight: 600;
    color: var(--colorTextBody);
  }

  .newsletter-popover__text {
    margin-bottom: 2rem;
    text-align: center;
    font-size: 1.1rem;
    color: var(--colorTextBody);
    opacity: 0.8;
  }

  .newsletter-popover__form-wrapper {
    transition: opacity 0.3s ease, visibility 0.3s ease;
  }

  .newsletter-popover__input-group {
    display: flex;
    gap: 0.75rem;
    margin-top: 1.5rem;
  }

  .newsletter-popover__input {
    flex: 1;
    padding: 0.875rem 1rem;
    border: 1px solid #ddd;
    border-radius: 4px;
    font-size: 1rem;
    transition: border-color 0.2s ease;
    background: #fff;
    color: var(--colorTextBody);
  }

  .newsletter-popover__input:focus {
    outline: none;
    border-color: #cb5c28;
  }

  .newsletter-popover__submit {
    background: #cb5c28;
    color: #fff;
    padding: 0.875rem 2rem;
    border: none;
    border-radius: 4px;
    font-weight: 600;
    font-size: 1rem;
    cursor: pointer;
    transition: background 0.3s ease;
    white-space: nowrap;
  }

  .newsletter-popover__submit:hover {
    background: #b54d20;
  }

  .newsletter-popover__error {
    background: #fee;
    color: #c00;
    padding: 0.75rem;
    border-radius: 4px;
    margin-bottom: 1rem;
    font-size: 0.95rem;
  }

  .newsletter-popover__success {
    text-align: center;
    padding: 2rem;
  }

  .newsletter-popover__success-icon {
    color: #4caf50;
    margin-bottom: 1rem;
  }

  .newsletter-popover__success-message {
    font-size: 1.25rem;
    color: var(--colorTextBody);
    margin: 0;
  }

  .newsletter-popover__close {
    position: absolute;
    top: 1rem;
    right: 1rem;
    background: none;
    border: none;
    padding: 0.5rem;
    cursor: pointer;
    color: var(--colorTextBody);
    opacity: 0.6;
    transition: opacity 0.2s ease;
  }

  .newsletter-popover__close:hover {
    opacity: 1;
  }

  .newsletter-popover__close .icon {
    width: 20px;
    height: 20px;
  }

  @media screen and (max-width: 768px) {
    .modal--newsletter-popover .modal__inner {
      width: 95%;
      max-width: none;
    }

    .newsletter-popover {
      padding: 2rem 1.5rem;
    }

    .newsletter-popover__title {
      font-size: 1.5rem;
    }

    .newsletter-popover__input-group {
      flex-direction: column;
    }

    .newsletter-popover__submit {
      width: 100%;
      padding: 1rem;
    }
  }
</style>

<script>
  document.addEventListener('DOMContentLoaded', function () {
    const popoverId = '{{ popover_id }}';
    const popover = document.getElementById(popoverId);
    if (!popover) return;

    const form = popover.querySelector('#{{ newsletter_form_id }}');
    const formWrapper = popover.querySelector('#form-wrapper-' + popoverId);
    const successDiv = popover.querySelector('#success-' + popoverId);
  });
</script>
