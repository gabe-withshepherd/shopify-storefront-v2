{% comment %}
  Newsletter Popover Snippet
  Usage: {% render 'newsletter-popover', id: 'unique-id', title: 'Join Our Newsletter', text: 'Sign up for exclusive offers' %}

  Parameters:
  - id: Unique identifier for the popover (required)
  - title: Heading text for the popover (optional, defaults to 'Join Our Newsletter')
  - text: Description text (optional)
  - button_text: Submit button text (optional, defaults to 'Sign Up')
{% endcomment %}

{% assign popover_id = id | default: 'newsletter-popover' %}
{% assign newsletter_form_id = 'newsletter-popover-form-' | append: popover_id %}

<div id="{{ popover_id }}" class="modal modal--square modal--newsletter-popover" data-popover-id="{{ popover_id }}">
  <div class="modal__inner">
    <div class="modal__centered-content">
      <button
        type="button"
        class="modal__close js-modal-close newsletter-popover__close"
        aria-label="{{ 'general.accessibility.close_modal' | t }}"
      >
        <svg aria-hidden="true" focusable="false" role="presentation" class="icon icon-close" viewBox="0 0 64 64">
          <title>icon-X</title>
          <path d="m19 17.61 27.12 27.13m0-27.12L19 44.74"/>
        </svg>
      </button>
      <div class="newsletter-popover__split-container">
        <div class="newsletter-popover__image-section">
          <picture>
            <source
              media="(max-width: 768px)"
              srcset="https://cdn.shopify.com/s/files/1/0686/3988/3581/files/24_121_7pacific_07344.jpg?v=1759115958"
            >
            <img
              src="https://cdn.shopify.com/s/files/1/0686/3988/3581/files/24_121_7pacific_019221_cropped2.png?v=1759113230"
              alt="Join our newsletter"
              class="newsletter-popover__image"
              loading="lazy"
              width="400"
              height="500"
            >
          </picture>
        </div>

        <div class="newsletter-popover__content-section">
          <div class="newsletter-popover__content">
            <h3 class="newsletter-popover__title">JOIN THE MEMBERSHIP</h3>

            <div class="newsletter-popover__text">
              Be the first to know about exclusive offers, new products, and community events. Join our membership
              today!
            </div>

            <div class="newsletter-popover__form-wrapper" id="form-wrapper-{{ popover_id }}">
              {% form 'customer', id: newsletter_form_id, class: 'newsletter-popover__form' %}
                <input type="hidden" name="contact[tags]" value="prospect,newsletter">
                <input type="hidden" name="contact[context]" value="popover">

                <div class="newsletter-popover__input-group">
                  <label for="email-{{ popover_id }}" class="visually-hidden">
                    {{- 'general.newsletter_form.newsletter_email' | t -}}
                  </label>
                  <input
                    type="email"
                    name="contact[email]"
                    id="email-{{ popover_id }}"
                    class="newsletter-popover__input"
                    placeholder="{{ 'general.newsletter_form.newsletter_email' | t }}"
                    value="{{ form.email }}"
                    {% if form.errors %}
                      autofocus
                      aria-invalid="true"
                      aria-describedby="ContactFooter-error"
                    {% elsif form.posted_successfully? %}
                      aria-describedby="ContactFooter-success"
                    {% endif %}
                    autocorrect="off"
                    autocapitalize="off"
                    required
                  >
                  {% render 'cta-button', text: 'SIGN UP', should_submit: true %}

                  {%- if form.errors -%}
                    <small class="newsletter-form__message form__message" id="ContactFooter-error">
                      <span class="svg-wrapper">
                        {{- 'icon-error.svg' | inline_asset_content -}}
                      </span>
                      {{- form.errors.translated_fields.email | capitalize }}
                      {{ form.errors.messages.email -}}
                    </small>
                  {%- endif -%}
                </div>

                {%- if form.posted_successfully? -%}
                  <h3
                    class="newsletter-form__message newsletter-form__message--success form__message"
                    id="ContactFooter-success"
                    tabindex="-1"
                    autofocus
                  >
                    <span class="svg-wrapper">
                      {{- 'icon-success.svg' | inline_asset_content -}}
                    </span>
                    You're locked in to the community!
                  </h3>
                {%- endif -%}
              {% endform %}
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<style>
  .modal--newsletter-popover .modal__inner {
    font-family: 'Barlow', sans-serif;
    background-color: #fff;
    box-shadow: 0 20px 60px rgba(0, 0, 0, 0.15);
    color: var(--colorTextBody, #000);
    max-width: 800px;
    border-radius: 2px;
    overflow: hidden;
    background-color: #282829;
  }

  .newsletter-popover__split-container {
    display: flex;
    height: 500px;
  }

  .newsletter-popover__image-section {
    width: 50%;
    position: relative;
    overflow: hidden;
  }

  .newsletter-popover__image {
    width: 100%;
    height: 100%;
    object-fit: cover;
  }

  .newsletter-popover__content-section {
    width: 50%;
    position: relative;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .newsletter-popover__content {
    width: 100%;
    max-width: 380px;
  }

  .newsletter-popover__title {
    /* font-family: 'Barlow', sans-serif; */
    font-size: 2rem;
    margin: 0 0 1rem;
    text-align: left;
    font-weight: 500;
    color: white;
  }

  .newsletter-popover__text {
    /* font-family: 'Barlow', sans-serif; */
    margin-bottom: 2rem;
    text-align: left;
    font-size: 1.1rem;
    color: white;
    opacity: 0.8;
  }

  .newsletter-popover__form-wrapper {
    transition: opacity 0.3s ease, visibility 0.3s ease;
  }

  .newsletter-popover__input-group {
    display: flex;
    flex-direction: column;
    gap: 0.4rem;
  }

  .newsletter-popover__input {
    width: 100%;
    padding: 0.7rem 0.7rem;
    border: 1px solid #ddd;
    border-radius: 2px;
    font-size: 1rem;
    transition: border-color 0.2s ease;
    background: #fff;
    color: var(--colorTextBody);
  }

  .newsletter-popover__input:focus {
    outline: none;
  }

  .newsletter-popover__error {
    background: #fee;
    color: #c00;
    padding: 0.75rem;
    border-radius: 4px;
    margin-bottom: 1rem;
    font-size: 0.95rem;
  }

  .newsletter-popover__success {
    text-align: center;
    padding: 2rem;
  }

  .newsletter-popover__success-icon {
    color: #4caf50;
    margin-bottom: 1rem;
  }

  .newsletter-popover__success-message {
    font-size: 1.25rem;
    color: var(--colorTextBody);
    margin: 0;
  }

  .newsletter-popover__close {
    position: absolute;
    background: none;
    border: none;
    cursor: pointer;
    opacity: 0.6;
    transition: opacity 0.2s ease;
    z-index: 10;
  }

  .newsletter-popover__close:hover {
    opacity: 1;
  }

  .newsletter-popover__close .icon {
    width: 24px;
    height: 24px;
    color: white;
  }

  @media screen and (max-width: 768px) {
    .modal--newsletter-popover .modal__inner {
      width: 90%;
      max-width: none;
    }

    .newsletter-popover__split-container {
      flex-direction: column;
      height: auto;
    }

    .newsletter-popover__image-section {
      width: 100%;
    }

    .newsletter-popover__content-section {
      width: 100%;
      padding: 1rem 1rem;
    }

    .newsletter-popover__title {
      font-size: 1.5rem;
      text-align: center;
    }

    .newsletter-popover__text {
      font-size: 0.9rem;
      text-align: center;
    }

    .newsletter-popover__input {
      padding: 0.5rem 0.5rem;
      font-size: 1rem;
    }

    .newsletter-popover__close .icon {
      width: 24px;
      height: 24px;
      color: black;
    }
  }
</style>

<script>
  document.addEventListener('DOMContentLoaded', function () {
    const popoverId = '{{ popover_id }}';
    const popover = document.getElementById(popoverId);
    if (!popover) return;

    const form = popover.querySelector('#{{ newsletter_form_id }}');
    const formWrapper = popover.querySelector('#form-wrapper-' + popoverId);
    const successDiv = popover.querySelector('#success-' + popoverId);
  });
</script>
